<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Obtaining Posterior Distributions}
-->
---
output:
  html_document:
    fig_caption: yes
    number_section: yes
    toc: yes
  pdf_document:
    fig_caption: yes
    number_section: yes
    toc: no
---

# A Brief Example of Using `Hyde` to Obtain Posterior Distributions

```{r}
library(HydeNet)
mtcars2 <- transform(mtcars,
                     cyl = factor(cyl),
                     gear=factor(gear),
                     am = factor(am))
carNet <- HydeNetwork( ~ cyl +
                         disp | cyl +
                         hp | disp +
                         wt +
                         gear +
                         mpg | disp*hp*wt*gear,
                       data=mtcars2)
plot(carNet)

compiledCar <- compileJagsModel(carNet, data=list(gear=4), n.chains=10)
plot(compiledCar)

S <- coda.samples(compiledCar$jags, c("hp", "wt", "mpg", "gear"), n.iter=1000)

summary(S)
plot(S)
```

Notice that we observed `gear=4`, but the output from `coda.samples` shows that `gear=2`.  This has to do with a difference in how R and JAGS read categorical variables.  JAGS prefers to work with the underlying numeric coding of a factor variable.  The referencing between JAGS and R is stored in the `compiledHydeNetwork` object's `factorRef` element.

```{r}
compiledCar$factorRef
```

From here, we can see that the `coda.samples` value 2 corresponds to the factor level 4.  Unfortunately, due to the structure of the `mcmc.list` object returned by `coda.samples`, there is no good way to relabel these values.  It may be more appropriate to relabel the levels after designing the output for your analysis.

# Adding nodes to an existing network

Suppose now that we determine that the transmission of a vehicle ought to be a node in the model.  We can use the `update` method to add the node without redefining all of the previous nodes

```{r}
carNet2 <- update(carNet, . ~ . + am + gear|am + wt|am)
plot(carNet2)

carNet2

compiledCar2 <- compileJagsModel(carNet2, data=list(gear=4, am=1), n.chains=10)
plot(compiledCar2)

S2 <- coda.samples(compiledCar2$jags, c("hp", "wt", "mpg", "gear"), n.iter=1000)

summary(S2)
plot(S2)
